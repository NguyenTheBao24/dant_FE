# Hướng dẫn tạo bảng Rooms trong Supabase

## Vấn đề hiện tại
Khi nhấn "Thêm khách thuê", dropdown chọn phòng không hiển thị gì vì bảng `rooms` chưa được tạo trong Supabase.

## Giải pháp

### Bước 1: Truy cập Supabase Dashboard
1. Đăng nhập vào [Supabase Dashboard](https://supabase.com/dashboard)
2. Chọn project của bạn
3. Vào **SQL Editor**

### Bước 2: Chạy script tạo bảng rooms
Copy và paste đoạn code sau vào SQL Editor:

```sql
-- Tạo bảng rooms
CREATE TABLE public.rooms (
    id bigint GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    hostel_id bigint NOT NULL,
    room_number text NOT NULL,
    room_type text NULL,
    rent_amount numeric NULL,
    status text DEFAULT 'available'::text,
    area numeric NULL,
    floor integer NULL,
    description text NULL,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    CONSTRAINT rooms_pkey PRIMARY KEY (id),
    CONSTRAINT rooms_hostel_id_fkey FOREIGN KEY (hostel_id) REFERENCES hostels(id) ON DELETE CASCADE,
    CONSTRAINT rooms_unique_per_hostel UNIQUE (hostel_id, room_number)
);

-- Tạo index
CREATE INDEX idx_rooms_hostel_id ON public.rooms(hostel_id);
CREATE INDEX idx_rooms_status ON public.rooms(status);
CREATE INDEX idx_rooms_room_number ON public.rooms(room_number);

-- Thêm cột room_id vào bảng tenants
ALTER TABLE public.tenants 
ADD COLUMN room_id bigint NULL,
ADD CONSTRAINT tenants_room_id_fkey FOREIGN KEY (room_id) REFERENCES rooms(id);

-- Enable Row Level Security
ALTER TABLE public.rooms ENABLE ROW LEVEL SECURITY;

-- Tạo policy
CREATE POLICY "Enable all operations for all users" ON public.rooms FOR ALL USING (true);

-- Thêm dữ liệu mẫu
INSERT INTO public.rooms (hostel_id, room_number, room_type, rent_amount, status, area, floor, description) VALUES
-- Khu trọ ABC (hostel_id = 1)
(1, 'A101', 'Phòng đơn', 2500000, 'available', 20, 1, 'Phòng đơn có ban công'),
(1, 'A102', 'Phòng đơn', 2500000, 'available', 20, 1, 'Phòng đơn có ban công'),
(1, 'A103', 'Phòng đôi', 3500000, 'available', 30, 1, 'Phòng đôi rộng rãi'),
(1, 'A104', 'Phòng đôi', 3500000, 'available', 30, 1, 'Phòng đôi rộng rãi'),
(1, 'A201', 'Phòng VIP', 4500000, 'available', 40, 2, 'Phòng VIP cao cấp'),
(1, 'A202', 'Phòng VIP', 4500000, 'available', 40, 2, 'Phòng VIP cao cấp'),
(1, 'A203', 'Phòng đơn', 2500000, 'available', 20, 2, 'Phòng đơn có ban công'),
(1, 'A204', 'Phòng đơn', 2500000, 'available', 20, 2, 'Phòng đơn có ban công'),

-- Khu trọ XYZ (hostel_id = 2)
(2, 'B101', 'Phòng đơn', 2000000, 'available', 18, 1, 'Phòng đơn tiết kiệm'),
(2, 'B102', 'Phòng đơn', 2000000, 'available', 18, 1, 'Phòng đơn tiết kiệm'),
(2, 'B103', 'Phòng đôi', 3000000, 'available', 25, 1, 'Phòng đôi bình dân'),
(2, 'B104', 'Phòng đôi', 3000000, 'available', 25, 1, 'Phòng đôi bình dân'),
(2, 'B201', 'Phòng đơn', 2000000, 'available', 18, 2, 'Phòng đơn tiết kiệm'),
(2, 'B202', 'Phòng đơn', 2000000, 'available', 18, 2, 'Phòng đơn tiết kiệm'),
(2, 'B203', 'Phòng đôi', 3000000, 'available', 25, 2, 'Phòng đôi bình dân'),
(2, 'B204', 'Phòng đôi', 3000000, 'available', 25, 2, 'Phòng đôi bình dân');
```

### Bước 3: Chạy script
1. Nhấn **Run** để thực thi script
2. Kiểm tra kết quả trong tab **Results**

### Bước 4: Kiểm tra
1. Vào **Table Editor**
2. Kiểm tra bảng `rooms` đã được tạo
3. Kiểm tra dữ liệu mẫu đã được thêm

## Sau khi hoàn thành
- Dropdown chọn phòng sẽ hiển thị danh sách phòng còn trống
- Có thể thêm khách thuê bình thường
- Hệ thống sẽ tự động cập nhật trạng thái phòng

## Lưu ý
- Nếu vẫn gặp lỗi, hãy kiểm tra lại connection string trong file `.env`
- Đảm bảo Supabase project đang hoạt động
- Có thể cần refresh lại trang web sau khi tạo bảng
